<script>
  // Force all polyfills on
  if (window.customElements)
    window.customElements.forcePolyfill = true;
  ShadyDOM = {
    force: true
  };
  ShadyCSS = {
    shimcssproperties: true
  };

</script>
<script src="/bower_components/webcomponentsjs/webcomponents-loader.js"></script>
<link rel="import" href="/bower_components/polymer/polymer.html">

<dom-module id="erasure-page-section">
  <template>
    <style>
      :host {
        display: block;
      }

    </style>

    <template>
      <div id="countDown">{{count}}</div>
    </template>

  <template is="dom-if" if="{{hasContent(sectionContent.subtitle)}}">
      <h3 class="oa_subheader">{{sectionContent.subtitle}}</h3>
    </template>

  <template is="dom-if" if="{{hasContent(sectionContent.blockquote)}}">
      <blockquote>{{sectionContent.blockquote}}</blockquote>
    </template>

  <template is="dom-repeat" items="{{sectionContent.content}}">
    <div class="oa_content_p">
        <p inner-h-t-m-l="{{item.paragraph}}"></p>
    </div>
    </template>

  <template is="dom-repeat" items="{{sectionContent.analogy}}">
      <p class="oa_no_margin" inner-h-t-m-l="{{item.margin}}"></p>
    </template>

  <template is="dom-repeat" items="{{sectionContent.content-2}}">
    <div class="oa_content_p">
        <p inner-h-t-m-l="{{item.paragraph}}"></p>
    </div>
      </template>
  </template>
  <script>
    (function()
    {
      'use strict';

      Polymer(
      {
        is: 'erasure-page-section',

        properties:
        {
          sectionContent:
          {
            type: Object,
            notify: true
          },
          synonyms:
          {
            type: Object,
            notify: true,
            value: function()
            {
              return {
                "forgetting": [
                  "obliterating",
                  "disremembering",
                  "slipping from memory",
                  "consigning to oblivion",
                  "drawing a blank",
                  "failing to remember"
                ],
                "memory": [
                  "consciousness",
                  "mind",
                  "recollection",
                  "remembrance",
                  "anamnesis",
                  "awareness",
                  "cognizance",
                  "flashback",
                  "retrospection"
                ],
                "print": [
                  "edition",
                  "stamp",
                  "writing",
                  "imprint"
                ],
                "erasure": [
                  "deletion",
                  "eradication",
                  "expunction",
                  "obliteration",
                  "blotting out",
                  "canceling",
                  "effacing",
                  "wiping out"
                ],
                "information": [
                  "advice",
                  "clue",
                  "data",
                  "intelligence",
                  "knowledge",
                  "material",
                  "message",
                  "report",
                  "notification"
                ],
                "record": [
                  "document",
                  "evidence",
                  "file",
                  "hstory",
                  "note",
                  "memo",
                  "report",
                  "story",
                  "testimony",
                  "transcript",
                  "archive",
                  "journal",
                  "log",
                  "register"
                ],
                "history": [
                  "past",
                  "antiquity",
                  "account",
                  "chronicle",
                  "background"
                ],
                "time": [
                  "age",
                  "date",
                  "day",
                  "era",
                  "generation",
                  "hour",
                  "moment",
                  "occasion",
                  "point",
                  "term",
                  "epoch",
                  "interval"
                ],
                "web": [
                  "net",
                  "cobweb",
                  "entanglement",
                  "network",
                  "complexity",
                  "labyrinth",
                  "tangle"
                ],
                "new": [
                  "contemporary",
                  "current",
                  "recent",
                  "unfamiliar",
                  "unique",
                  "virgin"
                ],
                "present": [
                  "current",
                  "contemporary",
                  "today",
                  "now",
                  "contemporaneous",
                  "extant"
                ],
                "has": [
                  "accepts",
                  "acquires",
                  "admits",
                  "bears",
                  "carries",
                  "enjoys",
                  "gains",
                  "gets",
                  "holds",
                  "keeps",
                  "obtains",
                  "owns",
                  "possesses",
                  "retains"
                ],
                "more": [
                  "also",
                  "extra",
                  "further",
                  "higher",
                  "new",
                  "other",
                  "spare",
                  "added",
                  "augmented",
                  "deeper",
                  "enhanced",
                  "exceeding",
                  "expanded",
                  "extended",
                  "farther",
                  "in addition",
                  "increased",
                  "innumerable",
                  "larger",
                  "numerous"
                ],
                "knowledge": [
                  "ability",
                  "awareness",
                  "education",
                  "expertise",
                  "familiarity",
                  "insight",
                  "intelligence",
                  "judgment",
                  "science",
                  "wisdom"
                ],
                "noise": [
                  "buzz",
                  "cacophony",
                  "clamor",
                  "commotion",
                  "crash",
                  "explosion",
                  "roar",
                  "turbulence",
                  "babble",
                  "bang",
                  "clang"
                ],
                "past": [
                  "history",
                  "antiquity"
                ],
                "each": [
                  "individual",
                  "particular",
                  "respective",
                  "all"
                ],
                "only": [
                  "solely",
                  "purely",
                  "merely"
                ],
                "process": [
                  "mechanism",
                  "operation",
                  "procedure",
                  "progress",
                  "system",
                  "technique",
                  "progression"
                ],
                "versions": [
                  "adaptations",
                  "interpretations",
                  "renditions",
                  "translations",
                  "variants",
                  "renderings"
                ],
                "cultural": [
                  "developmental",
                  "enriching",
                  "artistic",
                  "adorning",
                  "advancing",
                  "constructive"
                ],
                "also": [
                  "again",
                  "further",
                  "likewise",
                  "more",
                  "still",
                  "too",
                  "besides",
                  "additionally",
                  "along",
                  "and",
                  "as well as",
                  "furthermore",
                  "in conjunction with",
                  "including",
                  "moreover",
                  "on top of"
                ],
                "been": [
                  "abided",
                  "acted",
                  "done",
                  "endured",
                  "held",
                  "inhabited",
                  "persisted",
                  "lived"
                ],
                "piece": [
                  "bit",
                  "chunk",
                  "example",
                  "fragment",
                  "hunk",
                  "item",
                  "lot",
                  "portion",
                  "quantity",
                  "sample",
                  "scrap",
                  "section",
                  "segment",
                  "slice",
                  "specimen",
                  "allotment",
                  "fraction",
                  "morsel"
                ],
                "other": [
                  "alternative",
                  "more",
                  "another",
                  "auxiliary",
                  "else",
                  "extra",
                  "diverse",
                  "contrasting",
                  "disparate",
                  "otherwise",
                  "unrelated",
                  "variant"
                ],
                "recording": [
                  "documentation",
                  "documenting",
                  "registering",
                  "reporting",
                  "recounting",
                  "album"
                ],
                "being": [
                  "actuality",
                  "animation",
                  "life",
                  "presence",
                  "vitality",
                  "entity"
                ],
                "into": [
                  "toward",
                  "within"
                ],
                "various": [
                  "assorted",
                  "different",
                  "discrete",
                  "disparate",
                  "distinct",
                  "diverse",
                  "diversified",
                  "individual",
                  "numerous",
                  "separate",
                  "sundry"
                ],
                "after": [
                  "afterwards",
                  "later",
                  "subsequently",
                  "succeeding",
                  "thereafter",
                  "rear",
                  "after"
                ],
                "day": [
                  "period",
                  "term",
                  "time",
                  "age",
                  "ascendancy",
                  "cycle",
                  "epoch",
                  "generation",
                  "heyday",
                  "prime"
                ],
                "written": [
                  "drafted",
                  "recorded",
                  "authored",
                  "penned",
                  "reported",
                  "dictated",
                  "printed",
                  "signed",
                  "typed",
                  "lettered",
                  "transcribed"
                ],
                "get": [
                  "bring",
                  "draw",
                  "earn",
                  "gain",
                  "grab",
                  "have",
                  "land",
                  "make",
                  "obtain",
                  "pick up",
                  "pull",
                  "receive"
                ],
                "no": [
                  "negative",
                  "nix",
                  "never"
                ],
                "work": [
                  "effort",
                  "endeavor",
                  "industry",
                  "job",
                  "production",
                  "struggle",
                  "task",
                  "grind",
                  "drudge",
                  "undertaking"
                ],
                "dust": [
                  "dirt",
                  "earth",
                  "grime",
                  "lint",
                  "powder",
                  "sand",
                  "soil",
                  "soot",
                  "ashes",
                  "cinders",
                  "filth",
                  "flakes",
                  "fragments",
                  "grit",
                  "ground",
                  "grit"
                ],
                "internet": [
                  "cyberspace",
                  "www",
                  "arpanet",
                  "hyperspace",
                  "information",
                  "infobahn",
                  "net",
                  "web",
                  "online network"
                ],
                "people": [
                  "community",
                  "crowd",
                  "folk",
                  "population",
                  "public",
                  "society",
                  "bodies",
                  "citizens",
                  "clan",
                  "commonality",
                  "folks",
                  "horde",
                  "humanity",
                  "humankind",
                  "humans",
                  "inhabitants",
                  "masses",
                  "persons",
                  "populace",
                  "rabble"
                ],
                "world": [
                  "earth",
                  "nature",
                  "cosmos",
                  "macrocosm",
                  "microcosm"
                ],
                "idea": [
                  "belief",
                  "concept",
                  "feeling",
                  "intention",
                  "notion",
                  "objective",
                  "opinion",
                  "plan",
                  "scheme",
                  "theory",
                  "suggestion"
                ],
                "use": [
                  "adoption",
                  "handling",
                  "practice",
                  "operate",
                  "adopt",
                  "apply",
                  "control",
                  "exploit",
                  "manipulate",
                  "utilize"
                ],
                "room": [
                  "area",
                  "place",
                  "allowance",
                  "capacity",
                  "expanse",
                  "leeway",
                  "opportunity"
                ],
                "first": [
                  "initial",
                  "fundamental",
                  "early",
                  "primary",
                  "foremost",
                  "principal",
                  "original"
                ],
                "identities": [
                  ""
                ],
                "see": [
                  ""
                ],
                "human": [
                  ""
                ],
                "bodies": [
                  ""
                ],
                "such": [
                  ""
                ],
                "failure": [
                  ""
                ],
                "histories": [
                  ""
                ],
                "may": [
                  ""
                ],
                "over": [
                  ""
                ],
                "where": [
                  ""
                ],
                "news": [
                  ""
                ],
                "point": [
                  ""
                ],
                "part": [
                  ""
                ],
                "forget": [
                  ""
                ],
                "speech": [
                  ""
                ],
                "between": [
                  ""
                ],
                "way": [
                  ""
                ],
                "back": [
                  ""
                ],
                "like": [
                  ""
                ],
                "file": [
                  ""
                ],
                "if": [
                  ""
                ],
                "methods": [
                  ""
                ],
                "become": [
                  ""
                ],
                "erased": [
                  ""
                ],
                "voice": [
                  ""
                ],
                "future": [
                  ""
                ],
                "self": [
                  ""
                ],
                "until": [
                  ""
                ],
                "text": [
                  ""
                ],
                "original": [
                  ""
                ],
                "many": [
                  ""
                ],
                "before": [
                  ""
                ],
                "political": [
                  ""
                ],
                "lost": [
                  ""
                ],
                "down": [
                  ""
                ],
                "off": [
                  ""
                ],
                "collective": [
                  ""
                ],
                "generative": [
                  ""
                ],
              }
            }
          },
          count:
          {
            type: Number,
            value: 0,
            notify: true,
            observer: 'nextCount'
          }

        },

        _randomArrayMax: function randomArrayMax(max)
        {
          var randomArrayFromWordsSize = [];
          var maxRes = ((max * 3) / 2000);
          for (var i = 0; i < maxRes; i++)
          {
            randomArrayFromWordsSize[i] = Math.floor(Math.random() * max);
          }
          return randomArrayFromWordsSize;
        },


        _curateLongString: function curate(paragraph, synonyms)
        {
          var wordParagraphList = paragraph.split(' '); // look for space
          //count the words and randomizes the injection of the tags
          this._randomArrayMax(wordParagraphList.length)
            .forEach(function(pos)
            {
              // console.log(wordParagraphList[pos]);
              // if wordParagraphList[pos] contains any of this: <span class='oa_footnote_num' id='f_01'>1</span> don't remove
              if (wordParagraphList[pos].match(/span/g) || wordParagraphList[pos].match(/oa_footnote_num/g) || wordParagraphList[pos].match(/f_0/g) || wordParagraphList[pos].match(/</g))
              {
                // console.log("match!");
                // console.log(wordParagraphList[pos]);
              }
              else
              {
                var word = '' + wordParagraphList[pos];
                if (Math.random() >= 0.5 && synonyms.hasOwnProperty(word.toLowerCase()))
                {
                  var options = synonyms[word.toLowerCase()];
                  var randomSynonym = options[Math.floor(Math.random() * options.length)];
                  wordParagraphList[pos] = randomSynonym;
                }
                else
                {
                  wordParagraphList[pos] = word.replace(/./g, '\u00a0'); // &nbsp;
                }
              }
            });
          return wordParagraphList.join(' ');
        },

        _operatedContent: function(originalContent, target, synonyms)
        {
          var curatedString = ''
          if (this.hasContent(originalContent) && typeof(originalContent) !== 'object')
          {
            curatedString = this._curateLongString(originalContent, synonyms);
            this.set(target, curatedString);
            return true
          }
          else
          {
            return false;
          }
        },

        _doIt: function()
        {
          ['title', 'blockquote', 'subtitle', 'content', 'content-2', 'analogy', 'margin'] //Type of content defined inside erasure's json
          .forEach((section) =>
          {
            var sectionContent = this.get('sectionContent');
            var synonyms = this.get('synonyms');
            if (sectionContent.hasOwnProperty(section))
            {
              var target = 'sectionContent.' + section;
              var originalContent = this.get(target);

              if (!this._operatedContent(originalContent, target, synonyms) && typeof(originalContent) === 'object' && originalContent.length > 0)
              {
                originalContent.forEach((element, index) =>
                {
                  this._operatedContent(element.paragraph, target + '.' + index + '.paragraph', synonyms)
                })
              }
            }
          })
        },

        hasContent: function hasContent(content)
        {
          return typeof content === 'string' && '' !== content;
        },

        nextCount: function()
        {
          // will not call `destroy` more than once per 3000ms, and data binding will update it
          this.debounce('destroy', function()
          {
            if (this.count < this.visitors)
            {
              var count = this.get('count');
              this.set('count', count + 1);
              this._doIt();
            }
          }, 150);
        },


      });
    })
    ();

  </script>
</dom-module>
